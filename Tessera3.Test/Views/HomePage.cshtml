@section Navigation
{
	@Include("DefaultNavigation.cshtml")
}
@section WorkArea
{
	@Include("Section.cshtml")
}
<!DOCTYPE html>
<html>
<head>
	<title>@ViewBag.Title</title>
	<link href="/css/Reset.CSS" rel="stylesheet" type="text/css" />
	<link href="/css/Home.CSS" rel="stylesheet" type="text/css" />
	<link href="/css/Tessera.CSS" rel="stylesheet" type="text/css" />
	<meta content="text/html; charset=utf-8" http-equiv="content-type" />
</head>
<body>
	<div id="topmessage"><span>Подождите, контент загружается...</span></div>
	<div id="header"><h1>Информационная система Abc</h1></div>
	<div id="container">
		<div id="nav">@RenderSection("Navigation")</div>
		<div id="splitter" onclick="homePage.splitterClick()"></div>
		<div id="content">
			<div id="contenttitle"><h2>WorkAreaTitle</h2></div>
			<div id="contentbody">
				@RenderSection("WorkArea")
				<div id="ascx"></div>
			</div>
		</div>
	</div>
</body>

<script src="/js/jquery-1.7.2.min.js" type="text/javascript"></script>
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<script>
	var requestInProcess = false;

	$.ajax({
		url: '/web',
		type: 'GET',
		success: function (data) {
			$("#ascx").html(data);
			initForm();
		},
		error: function (data) {
			$('<iframe style="width:100%; height: 200px"/>').appendTo('#ascx').contents().find('body').append(data.responseText);
		},
		beforeSend: function () {
			requestInProcess = true;
			setTimeout(function () {
				if (requestInProcess) $("#topmessage").css('display', 'block');
			}, 100);
			
		},
		complete: function () {
			requestInProcess = false;
			$("#topmessage").css('display', 'none');
		}
	});

	var initForm = function () {
		var form = $('#form1');
		var submit = $("input[type=submit]", form);

		$(":submit", form).click(function () {
			if ($(this).attr('name')) {
				$(form).append(
					$("<input type='hidden'>").attr({
						name: $(this).attr('name'),
						value: $(this).attr('value')
					})
				);
			}
		});

		// form submit event
		form.on('submit', function (e) {
			e.preventDefault(); // prevent default form submit

			$.ajax({
				url: '/web',
				type: 'POST',
				dataType: 'html',
				data: form.serialize(), 
				beforeSend: function () {
				},
				success: function (data) {
					$("#ascx").html(data);
					initForm();
				},
				error: function (e) {
					console.log(e)
				}
			});
		});
	};

	var homePage = function () {
		var instance = {
			splitterClick: function () {
				if ($("#nav").css("display") != "none") {
					$.cookie("nav", "0", { path: '/' });
					HideNav();
				}
				else {
					$.cookie("nav", "", { path: '/' });
					ShowNav();
				}
			},   
			initNav: function () {
				if ($.cookie("nav") == "0") {
					HideNav();
				}
			},
			countNavBodyHeight: function () {
				var h = $(window).height() - $("#header").height() - $("#nav-header").height() - $("#nav-buttonsbar").height();
				$("#nav-body").css("height", h + "px");
				$("#nav-body").css("display", "block");
			}
		};

		function ShowNav() {
			$("#splitter").css("margin-left", "220px");
			$("#content").css("margin-left", "228px");
			$("#nav").css("display", "block");
		}
		function HideNav() {
			$("#splitter").css("margin-left", "0px");
			$("#content").css("margin-left", "8px");
			$("#nav").css("display", "none");
		}

		return instance;
	}();

	$(document).ready(function() {
		homePage.initNav();
		homePage.countNavBodyHeight();
	});
	$(window).resize(function () {
		homePage.countNavBodyHeight();
	});
</script>

</html>
